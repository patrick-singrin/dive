# CSS Variable Generation Scripts

## Overview

This set of Node.js scripts generates CSS custom properties (variables) from Figma-exported design token JSON files. It enables scalable, theme- and mode-aware CSS variable usage for developers, preserving Figma naming conventions and supporting multiple themes and color modes.

**Note:** This system generates CSS variables for use with Stencil components. Stencil naturally inherits CSS variables in shadow DOM, so no additional automation is needed for component styles.

## How CSS Variable Generation Works

The system transforms Figma-exported design tokens into developer-friendly CSS variables, supporting multiple themes and color modes. Here's how the process works:

### 1. **Token File Structure**
- **Theme Layer:** (`src/tokens/data/brand-theme/<theme>.json`) contains concrete palette values for each theme.
- **Mode Layer:** (`src/tokens/data/color-modes/<mode>.json`) maps semantic tokens to palette tokens for each color mode.
- **Component Layer:** (`src/tokens/data/components/component.json`) defines semantic/component tokens, referencing mode tokens.
- **(Optional) Layout Layer:** (`src/tokens/data/layouts/layout.json`) defines layout-level semantic tokens (currently disabled).

### 2. **Reference Resolution Cascade**
- The script starts with the component (or layout) token value.
- If the value is a reference (e.g., `{Primary.600}`), it looks for that path in the mode layer.
- If the mode layer value is also a reference, it looks for that path in the theme layer.
- If the theme layer contains a concrete value (e.g., `#2c72e0`), it is used as the final value.
- If any step fails, the script reports an unresolved token error.

### 3. **CSS Variable Generation**
- For each theme and each mode, the script generates a CSS file with variables for all resolved tokens.
- CSS variables are named by flattening the JSON path, preserving Figma's naming and structure (e.g., `--Color-Primary-Background-default`).
- Each mode gets its own CSS selector (e.g., `[data-mode="light"]`).
- An index file is generated for each theme, importing all relevant CSS files.
- A global index file imports all theme index files.

### 4. **Error Handling and Validation**
- The script detects and reports unresolved references, circular dependencies, and duplicate variable names.
- It provides a detailed summary after each run, including variable counts, unresolved tokens, and sample usage.

### 5. **Extensibility**
- The system is modular and can be extended to support more token sets, advanced validation, or watch mode.
- Layout support can be enabled by uncommenting the relevant line in the script and ensuring all references in `layout.json` are mapped in your mode files.

## CLI Usage

Run the main script from your project root:

```
node scripts/generate-css-variables.cjs [options]
```

**Options:**
- `--theme=<theme>`: Only generate for a specific theme (e.g., `--theme=dive-theme`)
- `--dry-run`: Preview what would be generated, without writing files
- `--output-dir=<dir>`: Specify a custom output directory
- `--verbose`: Enable verbose logging
- `--watch`: (Planned) Watch for changes and regenerate automatically

## Output Structure

```
src/tokens/css-vars/
  ├── <theme>/
  │   ├── component.css
  │   └── index.css
  └── index.css
```

- Only `component.css` is generated by default. Layout support is currently disabled (see below).

## Troubleshooting

- **Unresolved Token Errors:**
  - Ensure all references in your component/layout/mode/theme JSON files are correct and resolvable.
  - Semantic tokens (e.g., `Color.Primary.Subtle Background.default`) must be mapped in the mode files to palette values.
- **No Files Generated:**
  - Remove the `--dry-run` flag to actually write files.
- **Script Errors:**
  - Check for missing or invalid JSON files. The script will report helpful error messages.

## Extending the Scripts

- **Enable Layout Support:**
  - Uncomment the `layout` token set in `generate-css-variables.cjs` and ensure all references in `layout.json` are mapped in your mode files.
- **Add More Themes or Modes:**
  - Add new JSON files to the `brand-theme/` or `color-modes/` directories. The script will auto-discover them.
- **Improve Error Handling or Logging:**
  - The scripts are modular and can be extended for more advanced validation, reporting, or watch mode.

---

## Prompt for Improvements or Regeneration

If you want to:
- Regenerate this documentation
- Add new features (e.g., layout support, watch mode, advanced validation)
- Improve the summary or error handling
- Adapt the scripts for a new token structure

**Use this prompt:**

```
CSS VARIABLES GENERATION SCRIPT IMPROVEMENT PROMPT

I want to improve or regenerate the CSS variable generation scripts/documentation. My requirements are:
- [Describe your new requirements or changes here]

Please update the scripts and documentation accordingly, following best practices for Node.js, error handling, and developer experience.
```

---

For questions or improvements, see the comments in each script or contact the maintainers. 